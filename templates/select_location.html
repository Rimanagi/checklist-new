{% extends "base.html" %}
{% block title %}Выбор локации{% endblock %}
{% block content %}
  <h2>Выберите локацию</h2>
  <input type="text" id="searchInput" placeholder="Поиск локации" style="width: 100%; padding: 8px; margin-bottom: 20px;">

  <div class="locations-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
    {% for loc in locations %}
      <button type="button" onclick="selectLocation('{{ loc }}')"
              style="padding: 10px; background-color: #667eea; color: white; border: none; border-radius: 8px;">
        {{ loc }}
      </button>
    {% endfor %}
  </div>

  <!-- Скрытая форма для отправки POST запроса -->
  <form id="locationForm" method="post" style="display: none;">
    <input type="hidden" name="checklist_obj" value='{{ checklist.json() | safe }}'>
  </form>

  <script>
    function selectLocation(loc) {
      const form = document.getElementById("locationForm");
      form.action = "/select_location/" + encodeURIComponent(loc) + "/select_objects";
      form.submit();
    }

    document.getElementById("searchInput").addEventListener("input", function(){
      const filter = this.value.toLowerCase();
      const buttons = document.querySelectorAll(".locations-grid button");
      buttons.forEach(btn => {
          btn.style.display = btn.innerText.toLowerCase().includes(filter) ? "block" : "none";
      });
    });
  </script>
{% endblock %}